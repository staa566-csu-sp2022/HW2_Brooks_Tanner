---
title: "HW2 - 566 - Dynamic Visual"
author: "Tanner Brooks"
output: html_document
knit: (function(input_file, encoding) {
    out_dir <- 'docs';
    rmarkdown::render(input_file,
  encoding=encoding,
  output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
---



```{r}
library("survival")
library("survminer")
library("viridis")
library("plotly")
library("htmlwidgets")
library("GGally")
library("tidyverse")


# Creating basic model:
surv1 <- survfit(Surv(time,status) ~ sex, data = lung)

# Getting data for plotly graph
p <- ggsurv(surv1, CI = T)
df <- data.frame(prob = p$data$surv, sex = p$data$group, 
                 upper = p$data$up, lower = p$data$low, time = p$data$time)
df$sex <- ifelse(df$sex == 1, "Male", "Female")
df$sex <- as.factor(df$sex)
df_wider <- df %>%
  pivot_wider(names_from = sex, values_from = prob)

df_wider$MaleUpper <- ifelse(!is.na(df_wider$Male), df_wider$upper, NA)
df_wider$MaleLower <- ifelse(!is.na(df_wider$Male), df_wider$lower, NA)
df_wider$FemaleUpper <- ifelse(!is.na(df_wider$Female), df_wider$upper, NA)
df_wider$FemaleLower <- ifelse(!is.na(df_wider$Female), df_wider$lower, NA)


# Plotly interactive graph:
p_i <- plot_ly() %>% 
  add_lines(x = df_wider$time, y = ~df_wider$MaleUpper, name = "Upper Bound", 
            line = list(width=2, dash="dot", color = '#481567FF'), showlegend = FALSE
            , hovertemplate = paste('%{y}')) %>%
  add_lines(x = df_wider$time, y = ~df_wider$Male, name = "Male", line = list(color = '#481567FF') 
            , hovertemplate = paste('%{y}')) %>%
  add_lines(x = df_wider$time, y = ~df_wider$MaleLower, name = "Lower Bound", 
            line = list(width=2, dash="dot", color = '#481567FF'), showlegend = FALSE
            , hovertemplate = paste('%{y}')) %>%
  
  add_lines(x = df_wider$time, y = ~df_wider$FemaleUpper, name = "Upper Bound", 
            line = list(width=2, dash="dot", color = '#DCE319FF'), showlegend = FALSE
            , hovertemplate = paste('%{y}')) %>%
  add_lines(x = df_wider$time, y = ~df_wider$Female, name = "Female", line = list(color = '#DCE319FF') 
            , hovertemplate = paste('%{y}')) %>%
  add_lines(x = df_wider$time, y = ~df_wider$FemaleLower, name = "Upper Bound", 
            line = list(width=2, dash="dot", color = '#DCE319FF'), showlegend = FALSE
            , hovertemplate = paste('%{y}')) %>%
  layout(hovermode = "x unified", 
         title = "Survival Curves of Men and Women With Lung Cancer",
         xaxis = list(title = "Time (in days)"),
         yaxis = list(title = "Survival Probability")) %>%
  rangeslider()

p_i

```
